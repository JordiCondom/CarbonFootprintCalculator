<!DOCTYPE html>
<html>
<head>
	<title>Track Data</title>
    <link rel="stylesheet" type="text/css" href="/static/style.css">
	<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<style>
		
		.grid {
			display: grid;
			grid-gap: 10px; /* Adjust the gap between grid items as needed */
			width: 100%;
			height: 100%;
		}

		.message-box {
			background-color: #bdfbc3 !important; /* Adjust the background color as needed */
			padding: 20px; /* Adjust the padding as needed */
			border-radius: 5px; /* Adjust the border radius as needed */
			width: 100%; /* Make the message boxes fill the available width */
			box-sizing: border-box; /* Include padding and border in the box width */
		}
	</style>
    <script>
        function cb(selection) {
            $.getJSON({
                url: "/callback",
                data: { 'data': selection },
                success: function (result) {
                    Plotly.newPlot('barchart', result, {staticPlot: true});
                }
            });
        }
		function time_cb() {
			var dietChecked = document.querySelector('input[name="datatToPlot[]"][value="diet"]').checked;
			var transportationChecked = document.querySelector('input[name="datatToPlot[]"][value="transportation"]').checked;
			var housingChecked = document.querySelector('input[name="datatToPlot[]"][value="housing"]').checked;
			var consumptionChecked = document.querySelector('input[name="datatToPlot[]"][value="consumption"]').checked;
			var wasteChecked = document.querySelector('input[name="datatToPlot[]"][value="waste"]').checked;
			var totalChecked = document.querySelector('input[name="datatToPlot[]"][value="total"]').checked;

			// Create an array to hold the checked items
			var checkedItems = [];

			// Push the checked items to the array
			if (dietChecked) {
				checkedItems.push('diet');
			}
			if (transportationChecked) {
				checkedItems.push('transportation');
			}
			if (housingChecked) {
				checkedItems.push('housing');
			}
			if (consumptionChecked) {
				checkedItems.push('consumption');
			}
			if (wasteChecked) {
				checkedItems.push('waste');
			}
			if (totalChecked) {
				checkedItems.push('total');
			}

            var queryString = "data=" + checkedItems.join(',');

			$.getJSON("/callbackTime?" + queryString, function(result) {
				Plotly.newPlot('timefig', result, { staticPlot: true });
			});
        }
    </script>
</head>
<body>

<div class="container">
	<header>
		<nav>
			<a href="#dates" class="active">Dates</a>
			<a href="#data_track">Data tracking</a>
			<a href="#recommend">Recommendations</a>
			<a href="#carbonoffset">Carbon offsetting</a>
			<a href="/logout" class="logout-button">Logout</a>
		</nav>
	</header>
	<h1>Track Data</h1>

	<section id="dates">
		<div class="container reveal">
		<form action="/track" method="post">
			<div class="form-group">
			<label for="fromDate">From:</label>
			<input type="date" id="fromDate" name="fromDate" class="form-control">
			</div>
			
			<div class="form-group">
			<label for="toDate">To:</label>
			<input type="date" id="toDate" name="toDate" class="form-control">
			</div>
			
			<input type="submit" value="Track data within selected dates">

			{% if error %}
			<p style="color: red">{{ error }}</p>
			{% endif %}
		</form>
		</div>
	</section>
	
	<section id="data_track">
		<div class="container reveal">
		<p>Here's a plot of the data from {{from_date }} to {{to_date}}:</p>
		<div id="piechart"></div>
		</div>
	</section>

	<section id="data_track">
		<div class="container reveal">
			<p>Here's a plot of the data from {{from_date }} to {{to_date}}:</p>
			<div id="sunchart"></div>
		</div>
	</section>

	<section id="data_track">
		<div class="container reveal">
		<div>
			<select id="country-select" onchange="cb(this.value)">
				{% for country in countries %}
					<option value="{{ country }}">{{ country }}</option>
				{% endfor %}
			</select>
		</div>
		<div id="barchart"></div>
		</div>
	</section>

	<section id="data_track">
		<div class="container reveal">
			<div>
				<label>What data do you want to plot?</label><br>
				<div style="display: flex; justify-content: space-between;">
					<div>
					  <label><input type="checkbox" name="datatToPlot[]" value="diet" onchange="time_cb()" checked> Diet</label><br>
					  <label><input type="checkbox" name="datatToPlot[]" value="consumption" onchange="time_cb()" checked> Consumption</label><br>
					</div>
					<div>
					  <label><input type="checkbox" name="datatToPlot[]" value="transportation" onchange="time_cb()" checked> Transportation</label><br>
					  <label><input type="checkbox" name="datatToPlot[]" value="waste" onchange="time_cb()" checked> Waste</label><br>
					</div>
					<div>
					  <label><input type="checkbox" name="datatToPlot[]" value="housing" onchange="time_cb()" checked> Housing</label><br>
					  <label><input type="checkbox" name="datatToPlot[]" value="total" onchange="time_cb()" checked> Total</label><br>
					</div>
				  </div>
			</div>
			<div id="timefig"></div>
		</div>
	</section>

	<section id="recommend">
		<div class="container reveal">
			<div class="grid">
				<div class="grid" id="message-grid">
				</div>
			</div>
		</div>
	</section>

	<section id="carbonoffset">
		<div class="container reveal">
			<p> Just plant trees </p>
		</div>
	</section>


    <a href="/dashboard" class="button">Back to Dashboard</a>
</div>


<script>
	// Retrieve the graph data from the Flask route
	var pieGraphData = {{ pie_graph_data | tojson | safe }};
	// Parse the JSON data
	var pie_data = JSON.parse(pieGraphData);
	// Configure the chart layout
	var pie_layout = {
		title: 'Pie Chart',
		height: 600,
		width: 700
	};

	// Display the pie chart
	Plotly.newPlot('piechart', pie_data, pie_layout);


	// ------------------------------------------------
	// Sun chart

	var sunGraphData = {{sun_graph_data | tojson | safe }};

	var sun_data = JSON.parse(sunGraphData)

	var sun_layout = {
		title:'Sn chart',
		height: 600,
		widtth: 700
	};

	Plotly.newPlot('sunchart', sun_data, sun_layout)

	// ------------------------------------------------
	// Bar chart
	d = {{ graphJSON | safe }};
    Plotly.newPlot('barchart', d, {});
	// ------------------------------------------------

	var timeFigData = {{ time_fig_graph_data | tojson | safe }}
	var time_data = JSON.parse(timeFigData);

	var time_layout = {
		title: 'Time chart',
		height: 600,
		width: 700
	};

	Plotly.newPlot('timefig', time_data, time_layout);
	// ------------------------------------------------

	var recommendations_vector = {{ recommendations_vector | tojson }};
	console.log(recommendations_vector);

	// Get the grid container element
	let messageGrid = document.getElementById("message-grid");

	// Loop through the recommendations array and create message boxes
	recommendations_vector.forEach(recommendation => {
	let messageBox = document.createElement("div");
	messageBox.classList.add("message-box");
	messageBox.innerHTML = `<p>${recommendation}</p>`;
	messageGrid.appendChild(messageBox);
	});

	// ------------------------------------------------

	let section = document.querySelectorAll("section");
	let menu = document.querySelectorAll("header nav a");

	window.onscroll = () => {
	section.forEach((i) => {
		let top = window.scrollY;
		let offset = i.offsetTop - 150;
		let height = i.offsetHeight;
		let id = i.getAttribute("id");

		if (top >= offset && top < offset + height) {
		menu.forEach((link) => {
			link.classList.remove("active");
			document
			.querySelector("header nav a[href*=" + id + "]")
			.classList.add("active");
		});
		}
	});
	};

	function reveal() {
		var reveals = document.querySelectorAll(".reveal");

		for (var i = 0; i < reveals.length; i++) {
			var windowHeight = window.innerHeight;
			var elementTop = reveals[i].getBoundingClientRect().top;
			var elementVisible = 150;

			if (elementTop < windowHeight - elementVisible) {
			reveals[i].classList.add("active");
			} else {
			reveals[i].classList.remove("active");
			}
		}
	}

	window.addEventListener("scroll", reveal);

	// To check the scroll position on page load
	reveal();
</script>


</body>
</html>
